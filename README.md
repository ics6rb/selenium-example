# Пример тестирования ЛР9 при помощи Selenium

[Selenium](https://selenium.dev/) - это набор инструментов для [end-to-end (или e2e) тестирования](https://medium.com/the-hitchhikers-guide-to-e2e-testing/part-i-e2e-testing-and-selenium-ef031978ee20). Он используется для того, чтобы "притворяться" пользователем в каком-то определенном браузере, позволяет записать действия "пользователя" и воспроизводить их неограниченное количество раз по требованию, то есть автоматизирует процесс проверки работоспособности сайта в разных браузерах.

Необходимость такого вида тестирования обусловлена двумя основными причинами.

**Во-первых,** из-за особенностей работы браузеров, поведение (то есть внешний вид, расположение и, самое главное, "кликабельность") элементов могут различаться в разных браузерах, поэтому необходимо удостовериться в том, что в том наборе браузеров, которые поддерживает веб-приложение, все работает корректно, и пользователь вообще может, к примеру, нажать на какую-то кнопку.

**Во-вторых,** у любого приложения есть ряд глобальных сценариев (например, что пользователь может зарегистрироваться, войти, что он может оформить заказ в интернет-магазине), которые включают работу всех компонентов приложения и являются критичными для работы приложения (возвращаясь к примеру с заказом, в интернет-магазине может сломаться все, что угодно, но последней должна сломаться возможность делать там покупки). Единственный способ это проверить - полностью развернуть приложение на сервере и взаимодействовать с ним из браузера. Именно в этом может помочь Selenium.

В Selenium есть три инструмента: Selenium Webdriver, Selenium IDE и Selenium Grid.

**Selenium Webdriver** - это специальная программа, которая эмулирует конкретный браузер, и набор библиотек для разных языков программирования (сам Selenium написан на Java, но писать тесты можно не только на Java, но и на JS, Ruby, Python, ...), которые позволяют писать тесты в виде кода. Когда файл с такими тестами запускается, он обращается к Selenium, чтобы открыть окно браузера, изменить его размеры, загрузить нужную страницу, найти на ней элементы и т.д. **Чтобы запустить такие тесты, нужно установить драйвер для соответствующего браузера** (например, [для Chrome](https://sites.google.com/a/chromium.org/chromedriver/home), а также можно установить [Selenium Standalone Server](https://selenium.dev/downloads/) и подключаться к нему как к веб-приложению), потому что без него даже не откроется браузер - важно понимать, что вся логика реализована в этом драйвере и не имеет никакого отношения к, например, используемой вами библиотеке на Ruby, эта библиотека просто вызывает нужный драйвер.

**Selenium Grid** - это инструмент для параллельного запуска тестов. С помощью него можно запустить один и тот же сценарий в нескольких разных браузерах одновременно. Для того, чтобы это было возможно, специальным образом конфигурируется несколько физических или виртуальных серверов. Можно даже настроить Grid таким образов, чтобы он запускал тесты без графического интерфейса вообще - прямо в оперативной памяти сервера. Это критически важно для больших проектов, у которых много e2e тестов и которым нужно поддерживать работу своего веб-приложения в большом количестве разных браузеров, так как позволяет уменьшить время прогона тестов благодаря параллельному запуску и облегчить процесс настройки и подготовки большого количества разных тестовых окружений благодаря встроенным возможностям Selenium Grid.

**Selenium IDE** - это инструмент для быстрого прототипирования e2e-тестов прямо в браузере. Для IDE существуют расширения Chrome и Firefox. Как профессиональный инструмент Selenium IDE не подходит для работы даже со средними проектами и предоставляет весьма скудный набор возможностей. Огромным преимуществом Selenium IDE, тем не менее, является то, что **ее использование не требует никакой дополнительной настройки**, в связи с чем именно этот инструмент является наиболее предпочтительным для написания тестов по лабораторной работе 9.

## Куда смотреть

По классике: контроллер и представления. Моделей нет. Из специфических особенностей - используется AJAX через [server generated JSON response](https://signalvnoise.com/posts/3697-server-generated-javascript-responses).

Обратите внимание на тесты - они сделаны с помощью [RSpec](https://github.com/rspec/rspec-rails) и покрывают контроллеры, представления и маршруты.

Все, что связано с Selenium, находится в директории `selenium`. В ней же находится файл с более подробным описанием.

## Установка

`bundle install`

Также не забудьте установить ChromeDriver. Тут все сильно зависит от ОС, которую вы используете, и даже от конкретного дистрибутива, поэтому конкрутных рекомендаций не будет. Но в качестве отправной точки (и решения проблем в большинстве случаев) можно использовать [эту страницу](https://github.com/SeleniumHQ/selenium/wiki/ChromeDriver).

## Запуск

Для запуска приложения используйте команду `rails s`.

Для запуска тестов - `rake spec`.

Как запускать Selenium более подробно описано в файле `selemium/README.md` этого проекта.
